// Datastar Core v1.0.0-RC.12
var ee=/ðŸ–•JS_DSðŸš€/.source,$=ee.slice(0,5),H=ee.slice(4),S="datastar";var b=e=>e!==null&&typeof e=="object"&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null);function te(e){for(let t in e)if(Object.hasOwn(e,t))return!1;return!0}var m=(e,t)=>{for(let n in t){let i=n.split("."),s=i.pop(),r=i.reduce((o,a)=>o[a]??={},e);r[s]=t[n]}return e};function w(e){return e instanceof HTMLElement||e instanceof SVGElement}function L(e){return e?.closest("[data-scope]")?.dataset.scope??null}var K=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/([a-z])([0-9]+)/gi,"$1-$2").replace(/([0-9]+)([a-z])/gi,"$1-$2").toLowerCase(),T=e=>K(e).replace(/-./g,t=>t[1].toUpperCase()),O=e=>K(e).replace(/-/g,"_"),$e=e=>T(e).replace(/(^.|(?<=\.).)/g,t=>t[0].toUpperCase());var we={kebab:K,snake:O,pascal:$e};function D(e,t){for(let n of t.get("case")||[]){let i=we[n];i&&(e=i(e))}return e}function P(e,t,n){if(n.has("scoped")){let i=L(t);i&&(e=`${i}.${e}`)}return e}var ne={type:"attribute",name:"computed",keyReq:"must",valReq:"must",isExpr:!0,onLoad:({el:e,key:t,mods:n,rx:i,computed:s,mergePatch:r})=>{let o=D(t,n);o=P(o,e,n),r(m({},{[o]:s(i)}))}};var ie={type:"attribute",name:"effect",keyReq:"denied",valReq:"must",onLoad:({effect:e,rx:t})=>e(t)};var se={type:"attribute",name:"signals",isExpr:!0,onLoad:({el:e,key:t,mods:n,rx:i,mergePatch:s})=>{let r=n.has("ifmissing");if(t)t=P(D(t,n),e,n),s(m({},{[t]:i()}),{ifMissing:r});else{let o=i(),a={};for(let d in o)a[P(d,e,n)]=o[d];s(m({},a),{ifMissing:r})}}};var Le="https://data-star.dev/errors";function oe(e,t,n={}){let i=new Error;i.name=`${S} ${e} error`;let s=O(t),r=new URLSearchParams({metadata:JSON.stringify(n)}).toString(),o=JSON.stringify(n,null,2);return i.message=`${t}
More info: ${Le}/${e}/${s}?${r}
Context: ${o}`,i}function re(e,t,n={}){let i={plugin:{name:t.plugin.name,type:t.plugin.type}};return oe("init",e,Object.assign(i,n))}function ae(e,t,n={}){let i={plugin:{name:e.plugin.name,type:e.plugin.type},element:{id:e.el.id,tag:e.el.tagName},expression:{rawKey:e.rawKey,key:e.key,value:e.value,fnContent:e.fnContent}};return oe("runtime",t,Object.assign(i,n))}var ce=`${S}-signal-patch`;var _={},J=[],q=0,k=0,z=0,v,ue=()=>{q++},fe=()=>{--q||(me(),y())},A=e=>_e.bind(0,{previousValue:e,t:e,e:1}),de=Symbol("computed"),pe=e=>{let t=De.bind(0,{e:17,getter:e});return t[de]=1,t},ge=e=>{let t={d:e,e:2};v&&U(t,v);let n=R(t);try{t.d()}finally{R(n)}return he.bind(0,t)},Q=e=>{let t=R(void 0);try{return e()}finally{R(t)}},me=()=>{for(;k<z;){let e=J[k];J[k++]=void 0,Re(e,e.e&=-65)}k=0,z=0},le=e=>"getter"in e?ye(e):ve(e,e.t),R=e=>{let t=v;return v=e,t},ye=e=>{let t=R(e);xe(e);try{let n=e.t;return n!==(e.t=e.getter(n))}finally{R(t),Se(e)}},ve=(e,t)=>(e.e=1,e.previousValue!==(e.previousValue=t)),Z=e=>{let t=e.e;if(!(t&64)){e.e=t|64;let n=e.o;n?Z(n.r):J[z++]=e}},Re=(e,t)=>{if(t&16||t&32&&Te(e.s,e)){let i=R(e);xe(e);try{e.d()}finally{R(i),Se(e)}return}t&32&&(e.e=t&-33);let n=e.s;for(;n;){let i=n.c,s=i.e;s&64&&Re(i,i.e=s&-65),n=n.n}},De=e=>{let t=e.e;if(t&16||t&32&&Te(e.s,e)){if(ye(e)){let n=e.o;n&&j(n)}}else t&32&&(e.e=t&-33);return v&&U(e,v),e.t},_e=(e,...t)=>{if(t.length){let i=t[0];if(e.t!==(e.t=i)){e.e=17;let s=e.o;return s&&(ke(s),q||me()),!0}return!1}let n=e.t;if(e.e&16&&ve(e,n)){let i=e.o;i&&j(i)}return v&&U(e,v),n},he=e=>{let t=e.s;for(;t;)t=G(t,e);let n=e.o;n&&G(n),e.e=0},U=(e,t)=>{let n=t.a;if(n&&n.c===e)return;let i,s=t.e&4;if(s&&(i=n?n.n:t.s,i&&i.c===e)){t.a=i;return}let r=e.p;if(r&&r.r===t&&(!s||Ae(r,t)))return;let o=t.a=e.p={c:e,r:t,l:n,n:i,u:r};i&&(i.l=o),n?n.n=o:t.s=o,r?r.i=o:e.o=o},G=(e,t=e.r)=>{let n=e.c,i=e.l,s=e.n,r=e.i,o=e.u;if(s?s.l=i:t.a=i,i?i.n=s:t.s=s,r?r.u=o:n.p=o,o)o.i=r;else if(!(n.o=r))if("getter"in n){let a=n.s;if(a){n.e=17;do a=G(a,n);while(a)}}else"previousValue"in n||he(n);return s},ke=e=>{let t=e.i,n;e:for(;;){let i=e.r,s=i.e;if(s&3&&(s&60?s&12?s&4?!(s&48)&&Ae(e,i)?(i.e=s|40,s&=1):s=0:i.e=s&-9|32:s=0:i.e=s|32,s&2&&Z(i),s&1)){let r=i.o;if(r){e=r,r.i&&(n={t,f:n},t=e.i);continue}}if(e=t){t=e.i;continue}for(;n;)if(e=n.t,n=n.f,e){t=e.i;continue e}break}},xe=e=>{e.a=void 0,e.e=e.e&-57|4},Se=e=>{let t=e.a,n=t?t.n:e.s;for(;n;)n=G(n,e);e.e&=-5},Te=(e,t)=>{let n,i=0;e:for(;;){let s=e.c,r=s.e,o=!1;if(t.e&16)o=!0;else if((r&17)===17){if(le(s)){let a=s.o;a.i&&j(a),o=!0}}else if((r&33)===33){(e.i||e.u)&&(n={t:e,f:n}),e=s.s,t=s,++i;continue}if(!o&&e.n){e=e.n;continue}for(;i;){--i;let a=t.o,d=a.i;if(d?(e=n.t,n=n.f):e=a,o){if(le(t)){d&&j(a),t=e.r;continue}}else t.e&=-33;if(t=e.r,e.n){e=e.n;continue e}o=!1}return o}},j=e=>{do{let t=e.r,n=e.i,i=t.e;(i&48)===32&&(t.e=i|16,i&2&&Z(t)),e=n}while(e)},Ae=(e,t)=>{let n=t.a;if(n){let i=t.s;do{if(i===e)return!0;if(i===n)break;i=i.n}while(i)}return!1},B=e=>e.split(".").reduce((t,n)=>t[n],h),Ee=e=>Q(()=>e.split(".").reduce((t,n)=>t&&Object.hasOwn(t,n)?t[n]:void 0,h)!==void 0),N=(e,t="")=>{let n=Array.isArray(e);if(n||b(e)){let i=n?[]:{};for(let r in e)i[r]=A(N(e[r],`${t+r}.`));let s=A(0);return new Proxy(i,{get:(r,o)=>{if(!(o==="toJSON"&&!Object.hasOwn(i,o)))return n&&o in Array.prototype?(s(),i[o]):(Object.hasOwn(i,o)||(i[o]=A(""),y({[t+o]:""}),s(s()+1)),i[o]())},set:(r,o,a)=>{if(n&&o==="length")return i[o]=a,y({[t.slice(0,-1)]:i}),s(s()+1),!0;if(Object.hasOwn(i,o)){if(a==null)return delete i[o],y({[t+o]:null}),s(s()+1),!0;i[o](N(a,`${t+o}.`))&&y({[t+o]:a})}else{if(a==null)return!0;Object.hasOwn(a,de)?(i[o]=a,y({[t+o]:""})):(i[o]=A(N(a,`${t+o}.`)),y({[t+o]:a})),s(s()+1)}return!0},deleteProperty:(r,o)=>(Object.hasOwn(i,o)&&(delete i[o],y({[t+o]:null}),s(s()+1)),!0),ownKeys:()=>(s(),Reflect.ownKeys(i)),has(r,o){return s(),o in i}})}return e},y=e=>{if(e&&m(_,e),!q&&!te(_)){let t=_;_={},document.dispatchEvent(new CustomEvent(ce,{detail:t}))}},be=(e,{ifMissing:t}={})=>{ue();for(let n in e)e[n]===null||e[n]===void 0?t||delete h[n]:Oe(e[n],n,h,"",t);fe()},Oe=(e,t,n,i,s)=>{if(b(e)){Object.hasOwn(n,t)&&(b(n[t])||Array.isArray(n[t]))||(n[t]={});for(let r in e)e[r]===null||e[r]===void 0?s||delete n[t][r]:Oe(e[r],r,n[t],`${i+t}.`,s)}else s&&Object.hasOwn(n,t)||(n[t]=e)};function Pe({include:e=/.*/,exclude:t=/(?!)/}={},n=h){let i={},s=[[n,""]];for(;s.length;){let[r,o]=s.pop();for(let a in r)b(r[a])?s.push([r[a],`${o+a}.`]):e.test(o+a)&&!t.test(o+a)&&(i[o+a]=B(o+a))}return m({},i)}var h=N({}),C={},V=[],Fe=[],F=new Map,W=null,M="";function Ce(e){M=e}function Ne(e){return M?`data-${M}-${e}`:`data-${e}`}function X(...e){for(let t of e){let n={plugin:t,actions:C,root:h,filtered:Pe,signal:A,computed:pe,effect:ge,mergePatch:be,peek:Q,getPath:B,hasPath:Ee};if(t.type==="action")C[t.name]=t;else if(t.type==="attribute")V.push(t),t.onGlobalInit?.(n);else if(t.type==="watcher")t.onGlobalInit?.(n);else throw re("InvalidPluginType",n)}V.sort((t,n)=>{let i=n.name.length-t.name.length;return i!==0?i:t.name.localeCompare(n.name)}),Fe=V.map(t=>RegExp(`^${t.name}([A-Z]|_|$)`))}function I(e){for(let t of e)for(let n in t.dataset)Me(t,n,t.dataset[n])}function Y(e=document.body){queueMicrotask(()=>{I([e]),I(e.querySelectorAll("*")),W||(W=new MutationObserver(Ve),W.observe(e,{subtree:!0,childList:!0,attributes:!0}))})}function Me(e,t,n){let i=T(M?t.slice(M.length):t),s=V.find((r,o)=>Fe[o].test(i));if(s){let[r,...o]=i.slice(s.name.length).split(/__+/),a=!!r;a&&(r=T(r));let d=!!n,f={el:e,rawKey:i,key:r,value:n,mods:new Map,root:h,filtered:Pe,mergePatch:be,signal:A,computed:pe,effect:ge,plugin:s,actions:C,peek:Q,getPath:B,hasPath:Ee,runtimeErr:0,rx:0};f.runtimeErr=ae.bind(0,f),f.rx=Ge(f);let x=s.keyReq||"allowed";if(a){if(x==="denied")throw f.runtimeErr(`${s.name}KeyNotAllowed`)}else if(x==="must")throw f.runtimeErr(`${s.name}KeyRequired`);let u=s.valReq||"allowed";if(d){if(u==="denied")throw f.runtimeErr(`${s.name}ValueNotAllowed`)}else if(u==="must")throw f.runtimeErr(`${s.name}ValueRequired`);if(x==="exclusive"||u==="exclusive"){if(a&&d)throw f.runtimeErr(`${s.name}KeyAndValueProvided`);if(!a&&!d)throw f.runtimeErr(`${s.name}KeyOrValueRequired`)}for(let l of o){let[p,...g]=l.split(".");f.mods.set(T(p),new Set(g.map(E=>E.toLowerCase())))}ue();let c=s.onLoad(f);if(fe(),c){let l=F.get(e);l?l.get(i)?.():(l=new Map,F.set(e,l)),l.set(i,c)}}}function Ve(e){let t=`[${Ne("ignore")}]`;for(let{target:n,type:i,attributeName:s,addedNodes:r,removedNodes:o}of e)if(i==="childList"){for(let a of o)if(w(a)){let d=F.get(a);if(F.delete(a)){for(let f of d.values())f();d.clear()}}for(let a of r)w(a)&&(I([a]),I(a.querySelectorAll("*")))}else if(i==="attributes"&&w(n)&&!n.closest(t)){let a=T(s.slice(5)),d=n.getAttribute(s);if(d===null){let f=F.get(n);f&&(f.get(a)?.(),f.delete(a))}else Me(n,a,d)}}function Ge(e){let t="",n=e.plugin||void 0;if(n?.isExpr){let u=/(\/(\\\/|[^/])*\/|"(\\"|[^"])*"|'(\\'|[^'])*'|`(\\`|[^`])*`|\(\s*((function)\s*\(\s*\)|(\(\s*\))\s*=>)\s*(?:\{[\s\S]*?\}|[^;){]*)\s*\)\s*\(\s*\)|[^;])+/gm,c=e.value.trim().match(u);if(c){let l=c.length-1,p=c[l].trim();p.startsWith("return")||(c[l]=`return (${p});`),t=c.join(`;
`)}}else t=e.value.trim();t=t.replace(/\$\$([a-zA-Z_][\w.-]*(?:\.[a-zA-Z_][\w.-]*)*?)(?=\s|$|[^\w.-])/g,(u,c)=>{let l=L(e.el);return l?`$${l}.${c}`:`$${c}`}),t=t.replace(/\$([a-zA-Z_][\w.-]*(?:\.[a-zA-Z_][\w.-]*)*?)(?=\s|$|[^\w.-])/g,(u,c)=>c.endsWith("-")&&u.length<t.length&&t[t.indexOf(u)+u.length]==="$"?(c=c.slice(0,-1),`${c.split(".").reduce((g,E)=>`${g}['${E}']`,"$")}-`):c.split(".").reduce((p,g)=>`${p}['${g}']`,"$"));let i=new Map,s=RegExp(`(?:${$})(.*?)(?:${H})`,"gm");for(let u of t.matchAll(s)){let c=u[1],l=`dsEscaped${je(c)}`;i.set(l,c),t=t.replace($+c+H,l)}let r=(u,c)=>`${u}${O(c).replaceAll(/\./g,"_")}`,o=new Set,a=RegExp(`@(${Object.keys(C).join("|")})\\(`,"gm"),d=[...t.matchAll(a)],f=new Set,x=new Set;if(d.length){let u=`${S}Act_`;for(let c of d){let l=c[1],p=C[l];if(!p)continue;o.add(l);let g=r(u,l);t=t.replace(`@${l}(`,`${g}(`),f.add(g),x.add((...E)=>p.fn(e,...E))}}for(let[u,c]of i)t=t.replace(u,c);e.fnContent=t;try{let u=Function("el","$",...n?.argNames||[],...f,t);return(...c)=>{try{return u(e.el,h,...c,...x)}catch(l){throw e.runtimeErr("ExecuteExpression",{error:l.message})}}}catch(u){throw e.runtimeErr("GenerateExpression",{error:u.message})}}function je(e){let t=5831,n=e.length;for(;n--;)t+=(t<<5)+e.charCodeAt(n);return(t>>>0).toString(36)}X(se,ne,ie);Y();export{Y as apply,X as load,Ce as setAlias};
//# sourceMappingURL=datastar-core.js.map
