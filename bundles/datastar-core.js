// Datastar Core v1.0.0-RC.5
var Y=/ðŸ–•JS_DSðŸš€/.source,C=Y.slice(0,5),H=Y.slice(4),E="datastar";function $(e){return e instanceof HTMLElement||e instanceof SVGElement}var A=e=>e!==null&&typeof e=="object"&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null);var w=e=>{let t={};for(let[n,i]of e){let s=n.split("."),a=s.pop(),r=s.reduce((o,c)=>o[c]??={},t);r[a]=i}return t};var ee=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/([a-z])([0-9]+)/gi,"$1-$2").replace(/([0-9]+)([a-z])/gi,"$1-$2").toLowerCase(),b=e=>ee(e).replace(/-./g,t=>t[1].toUpperCase()),D=e=>ee(e).replace(/-/g,"_");var Me="https://data-star.dev/errors";function te(e,t,n={}){let i=new Error;i.name=`${E} ${e} error`;let s=D(t),a=new URLSearchParams({metadata:JSON.stringify(n)}).toString(),r=JSON.stringify(n,null,2);return i.message=`${t}
More info: ${Me}/${e}/${s}?${a}
Context: ${r}`,i}function q(e,t,n={}){let i={plugin:{name:e.plugin.name,type:e.plugin.type}};return te("init",t,Object.assign(i,n))}function ne(e,t,n={}){let i={plugin:{name:e.plugin.name,type:e.plugin.type},element:{id:e.el.id,tag:e.el.tagName},expression:{rawKey:e.rawKey,key:e.key,value:e.value,fnContent:e.fnContent}};return te("runtime",t,Object.assign(i,n))}var ie=`${E}-signal-patch`;var L=[],J=[],I=0,_=0,W=0,v,F=()=>{I++},M=()=>{--I||(fe(),p())},T=e=>$e.bind(0,{previousValue:e,t:e,e:1}),z=Symbol("computed"),ce=e=>{let t=Ce.bind(0,{e:17,getter:e});return t[z]=1,t},le=e=>{let t={d:e,e:2};v&&B(t,v);let n=R(t);F();try{t.d()}finally{M(),R(n)}return ye.bind(0,t)},ue=e=>{let t=R(void 0);try{return e()}finally{R(t)}},fe=()=>{for(;_<W;){let e=J[_];J[_++]=void 0,pe(e,e.e&=-65)}_=0,W=0},se=e=>"getter"in e?de(e):ge(e,e.t),R=e=>{let t=v;return v=e,t},de=e=>{let t=R(e);me(e);try{let n=e.t;return n!==(e.t=e.getter(n))}finally{R(t),ve(e)}},ge=(e,t)=>(e.e=1,e.previousValue!==(e.previousValue=t)),Q=e=>{let t=e.e;if(!(t&64)){e.e=t|64;let n=e.r;n?Q(n.o):J[W++]=e}},pe=(e,t)=>{if(t&16||t&32&&Re(e.s,e)){let i=R(e);me(e),F();try{e.d()}finally{M(),R(i),ve(e)}return}t&32&&(e.e=t&-33);let n=e.s;for(;n;){let i=n.c,s=i.e;s&64&&pe(i,i.e=s&-65),n=n.n}},Ce=e=>{let t=e.e;if(t&16||t&32&&Re(e.s,e)){if(de(e)){let n=e.r;n&&j(n)}}else t&32&&(e.e=t&-33);return v&&B(e,v),e.t},$e=(e,...t)=>{if(t.length){let i=t[0];if(e.t!==(e.t=i)){e.e=17;let s=e.r;return s&&(we(s),I||fe()),!0}return!1}let n=e.t;if(e.e&16&&ge(e,n)){let i=e.r;i&&j(i)}return v&&B(e,v),n},ye=e=>{let t=e.s;for(;t;)t=V(t,e);let n=e.r;n&&V(n),e.e=0},B=(e,t)=>{let n=t.a;if(n&&n.c===e)return;let i,s=t.e&4;if(s&&(i=n?n.n:t.s,i&&i.c===e)){t.a=i;return}let a=e.g;if(a&&a.o===t&&(!s||he(a,t)))return;let r=t.a=e.g={c:e,o:t,l:n,n:i,u:a};i&&(i.l=r),n?n.n=r:t.s=r,a?a.i=r:e.r=r},V=(e,t=e.o)=>{let n=e.c,i=e.l,s=e.n,a=e.i,r=e.u;if(s?s.l=i:t.a=i,i?i.n=s:t.s=s,a?a.u=r:n.g=r,r)r.i=a;else if(!(n.r=a))if("getter"in n){let o=n.s;if(o){n.e=17;do o=V(o,n);while(o)}}else"previousValue"in n||ye(n);return s},we=e=>{let t=e.i,n;e:for(;;){let i=e.o,s=i.e;if(s&3&&(s&60?s&12?s&4?!(s&48)&&he(e,i)?(i.e=s|40,s&=1):s=0:i.e=s&-9|32:s=0:i.e=s|32,s&2&&Q(i),s&1)){let a=i.r;if(a){e=a,a.i&&(n={t,f:n},t=e.i);continue}}if(e=t){t=e.i;continue}for(;n;)if(e=n.t,n=n.f,e){t=e.i;continue e}break}},me=e=>{e.a=void 0,e.e=e.e&-57|4},ve=e=>{let t=e.a,n=t?t.n:e.s;for(;n;)n=V(n,e);e.e&=-5},Re=(e,t)=>{let n,i=0;e:for(;;){let s=e.c,a=s.e,r=!1;if(t.e&16)r=!0;else if((a&17)===17){if(se(s)){let o=s.r;o.i&&j(o),r=!0}}else if((a&33)===33){(e.i||e.u)&&(n={t:e,f:n}),e=s.s,t=s,++i;continue}if(!r&&e.n){e=e.n;continue}for(;i;){--i;let o=t.r,c=o.i;if(c?(e=n.t,n=n.f):e=o,r){if(se(t)){c&&j(o),t=e.o;continue}}else t.e&=-33;if(t=e.o,e.n){e=e.n;continue e}r=!1}return r}},j=e=>{do{let t=e.o,n=e.i,i=t.e;(i&48)===32&&(t.e=i|16,i&2&&Q(t)),e=n}while(e)},he=(e,t)=>{let n=t.a;if(n){let i=t.s;do{if(i===e)return!0;if(i===n)break;i=i.n}while(i)}return!1},U=e=>{let t=h,n=e.split(".");for(let i of n){if(t==null||!Object.hasOwn(t,i))return;t=t[i]}return t},re=Symbol("delete"),N=(e,t="")=>{let n=Array.isArray(e);if(n||A(e)){let i=n?[]:{};for(let a in e)i[a]=T(N(e[a],`${t+a}.`));let s=T(0);return new Proxy(i,{get(a,r){if(!(r==="toJSON"&&!Object.hasOwn(i,r)))return n&&r in Array.prototype?(s(),i[r]):typeof r=="symbol"?i[r]:((!Object.hasOwn(i,r)||i[r]()==null)&&(i[r]=T(""),p(t+r,""),s(s()+1)),i[r]())},set(a,r,o){let c=t+r;if(o===re)Object.hasOwn(i,r)&&(delete i[r],p(c,re),s(s()+1));else if(n&&r==="length"){let u=i[r]-o;if(i[r]=o,u>0){let y={};for(let g=o;g<i[r];g++)y[g]=null;p(t.slice(0,-1),y),s(s()+1)}}else Object.hasOwn(i,r)?o==null?i[r](null)&&p(c,null):Object.hasOwn(o,z)?(i[r]=o,p(c,"")):i[r](N(o,`${c}.`))&&p(c,o):o!=null&&(Object.hasOwn(o,z)?(i[r]=o,p(c,"")):(i[r]=T(N(o,`${c}.`)),p(c,o)),s(s()+1));return!0},deleteProperty(a,r){return Object.hasOwn(i,r)&&i[r](null)&&p(t+r,null),!0},ownKeys(){return s(),Reflect.ownKeys(i)},has(a,r){return s(),r in i}})}return e},p=(e,t)=>{if(e!==void 0&&t!==void 0&&L.push([e,t]),!I&&L.length){let n=w(L);L.length=0,document.dispatchEvent(new CustomEvent(ie,{detail:n}))}},Z=(e,{ifMissing:t}={})=>{F();for(let n in e)e[n]==null?t||delete h[n]:Ee(e[n],n,h,"",t);M()},xe=(e,t={})=>Z(w(e),t),Ee=(e,t,n,i,s)=>{if(A(e)){Object.hasOwn(n,t)&&(A(n[t])||Array.isArray(n[t]))||(n[t]={});for(let a in e)e[a]==null?s||delete n[t][a]:Ee(e[a],a,n[t],`${i+t}.`,s)}else s&&Object.hasOwn(n,t)||(n[t]=e)};function Te({include:e=/.*/,exclude:t=/(?!)/}={},n=h){let i=[],s=[[n,""]];for(;s.length;){let[a,r]=s.pop();for(let o in a){let c=r+o;A(a[o])?s.push([a[o],`${c}.`]):oe(e).test(c)&&!oe(t).test(c)&&i.push([c,U(c)])}}return w(i)}function oe(e){return typeof e=="string"?RegExp(e.replace(/^\/|\/$/g,"")):e}var h=N({}),P={},k=[],Se=[],O=new Map,K=null,S="";function Ae(e){S=e}function be(e){return S?`data-${S}-${e}`:`data-${e}`}function Pe(...e){for(let t of e){let n={plugin:t,actions:P,root:h,filtered:Te,signal:T,computed:ce,effect:le,mergePatch:Z,mergePaths:xe,peek:ue,getPath:U,startBatch:F,endBatch:M,initErr:0};if(n.initErr=q.bind(0,n),t.type==="action")P[t.name]=t;else if(t.type==="attribute")k.push(t),t.onGlobalInit?.(n);else if(t.type==="watcher")t.onGlobalInit?.(n);else throw n.initErr("InvalidPluginType")}k.sort((t,n)=>{let i=n.name.length-t.name.length;return i!==0?i:t.name.localeCompare(n.name)}),Se=k.map(t=>RegExp(`^${t.name}([A-Z]|_|$)`))}function G(e){let t=`[${be("ignore")}]`;for(let n of e)if(!n.closest(t))for(let i in n.dataset)Oe(n,i,n.dataset[i])}function ae(e){for(let t of e){let n=O.get(t);if(O.delete(t)){for(let i of n.values())i();n.clear()}}}function X(e=document.body){queueMicrotask(()=>{G([e]),G(e.querySelectorAll("*")),K||(K=new MutationObserver(De),K.observe(e,{subtree:!0,childList:!0,attributes:!0}))})}function Oe(e,t,n){if(t.startsWith(S)){let i=b(S?t.slice(S.length):t),s=k.find((a,r)=>Se[r].test(i));if(s){let[a,...r]=i.slice(s.name.length).split(/__+/),o=!!a;o&&(a=b(a));let c=!!n,u={plugin:s,actions:P,root:h,filtered:Te,signal:T,computed:ce,effect:le,mergePatch:Z,mergePaths:xe,peek:ue,getPath:U,startBatch:F,endBatch:M,initErr:0,el:e,rawKey:i,key:a,value:n,mods:new Map,runtimeErr:0,rx:0};u.initErr=q.bind(0,u),u.runtimeErr=ne.bind(0,u),(s.shouldEvaluate===void 0||s.shouldEvaluate===!0)&&(u.rx=Le(u));let y=s.keyReq||"allowed";if(o){if(y==="denied")throw u.runtimeErr(`${s.name}KeyNotAllowed`)}else if(y==="must")throw u.runtimeErr(`${s.name}KeyRequired`);let g=s.valReq||"allowed";if(c){if(g==="denied")throw u.runtimeErr(`${s.name}ValueNotAllowed`)}else if(g==="must")throw u.runtimeErr(`${s.name}ValueRequired`);if(y==="exclusive"||g==="exclusive"){if(o&&c)throw u.runtimeErr(`${s.name}KeyAndValueProvided`);if(!o&&!c)throw u.runtimeErr(`${s.name}KeyOrValueRequired`)}for(let l of r){let[d,...m]=l.split(".");u.mods.set(b(d),new Set(m.map(x=>x.toLowerCase())))}let f=s.onLoad(u);if(f){let l=O.get(e);l?l.get(i)?.():(l=new Map,O.set(e,l)),l.set(i,f)}}}}function De(e){let t=`[${be("ignore")}]`;for(let{target:n,type:i,attributeName:s,addedNodes:a,removedNodes:r}of e)if(i==="childList"){for(let o of r)$(o)&&(ae([o]),ae(o.querySelectorAll("*")));for(let o of a)$(o)&&(G([o]),G(o.querySelectorAll("*")))}else if(i==="attributes"&&$(n)&&!n.closest(t)){let o=b(s.slice(5)),c=n.getAttribute(s);if(c===null){let u=O.get(n);u&&(u.get(o)?.(),u.delete(o))}else Oe(n,o,c)}}function Le(e){let t="",n=e.plugin||void 0;if(n?.returnsValue){let f=/(\/(\\\/|[^/])*\/|"(\\"|[^"])*"|'(\\'|[^'])*'|`(\\`|[^`])*`|\(\s*((function)\s*\(\s*\)|(\(\s*\))\s*=>)\s*(?:\{[\s\S]*?\}|[^;){]*)\s*\)\s*\(\s*\)|[^;])+/gm,l=e.value.trim().match(f);if(l){let d=l.length-1,m=l[d].trim();m.startsWith("return")||(l[d]=`return (${m});`),t=l.join(`;
`)}}else t=e.value.trim();t=t.replace(/\$\['([a-zA-Z_$\d][\w$]*)'\]/g,"$$$1").replace(/\$([a-zA-Z_\d]\w*(?:[.-]\w+)*)/g,(f,l)=>l.split(".").reduce((m,x)=>`${m}['${x}']`,"$")).replace(/\[(\$[a-zA-Z_\d]\w*)\]/g,(f,l)=>`[$['${l.slice(1)}']]`);let i=new Map,s=RegExp(`(?:${C})(.*?)(?:${H})`,"gm"),a=0;for(let f of t.matchAll(s)){let l=f[1],d=`dsEscaped${a++}`;i.set(d,l),t=t.replace(C+l+H,d)}let r=(f,l)=>`${f}${D(l).replaceAll(/\./g,"_")}`,o=new Set,c=RegExp(`@(${Object.keys(P).join("|")})\\(`,"gm"),u=[...t.matchAll(c)],y=new Set,g=new Set;if(u.length){let f=`${E}Act_`;for(let l of u){let d=l[1],m=P[d];if(!m)continue;o.add(d);let x=r(f,d);t=t.replace(`@${d}(`,`${x}(`),y.add(x),g.add((...Fe)=>m.fn(e,...Fe))}}for(let[f,l]of i)t=t.replace(f,l);e.fnContent=t;try{let f=Function("el","$",...n?.argNames||[],...y,t);return(...l)=>{try{return f(e.el,h,...l,...g)}catch(d){throw e.runtimeErr("ExecuteExpression",{error:d.message})}}}catch(f){throw e.runtimeErr("GenerateExpression",{error:f.message})}}X();export{X as apply,Pe as load,Ae as setAlias};
//# sourceMappingURL=datastar-core.js.map
