// Datastar Core v1.0.0-RC.4
var X=/ðŸ–•JS_DSðŸš€/.source,C=X.slice(0,5),I=X.slice(4),E="datastar";function w(e){return e instanceof HTMLElement||e instanceof SVGElement}var b=e=>e!==null&&typeof e=="object"&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null);function Y(e){for(let t in e)if(Object.hasOwn(e,t))return!1;return!0}var H=(e,t)=>{for(let n in t){let i=n.split("."),s=i.pop(),a=i.reduce((o,r)=>o[r]??={},e);a[s]=t[n]}return e};var ee=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/([a-z])([0-9]+)/gi,"$1-$2").replace(/([0-9]+)([a-z])/gi,"$1-$2").toLowerCase(),A=e=>ee(e).replace(/-./g,t=>t[1].toUpperCase()),$=e=>ee(e).replace(/-/g,"_");var Me="https://data-star.dev/errors";function te(e,t,n={}){let i=new Error;i.name=`${E} ${e} error`;let s=$(t),a=new URLSearchParams({metadata:JSON.stringify(n)}).toString(),o=JSON.stringify(n,null,2);return i.message=`${t}
More info: ${Me}/${e}/${s}?${a}
Context: ${o}`,i}function q(e,t,n={}){let i={plugin:{name:e.plugin.name,type:e.plugin.type}};return te("init",t,Object.assign(i,n))}function ne(e,t,n={}){let i={plugin:{name:e.plugin.name,type:e.plugin.type},element:{id:e.el.id,tag:e.el.tagName},expression:{rawKey:e.rawKey,key:e.key,value:e.value,fnContent:e.fnContent}};return te("runtime",t,Object.assign(i,n))}var ie=`${E}-signal-patch`;var D={},W=[],G=0,L=0,J=0,y,P=()=>{G++},M=()=>{--G||(fe(),g())},T=e=>we.bind(0,{previousValue:e,t:e,e:1}),z=Symbol("computed"),ce=e=>{let t=Ce.bind(0,{e:17,getter:e});return t[z]=1,t},le=e=>{let t={d:e,e:2};y&&B(t,y);let n=m(t);P();try{t.d()}finally{M(),m(n)}return ye.bind(0,t)},ue=e=>{let t=m(void 0);try{return e()}finally{m(t)}},fe=()=>{for(;L<J;){let e=W[L];W[L++]=void 0,pe(e,e.e&=-65)}L=0,J=0},se=e=>"getter"in e?de(e):ge(e,e.t),m=e=>{let t=y;return y=e,t},de=e=>{let t=m(e);me(e);try{let n=e.t;return n!==(e.t=e.getter(n))}finally{m(t),ve(e)}},ge=(e,t)=>(e.e=1,e.previousValue!==(e.previousValue=t)),Q=e=>{let t=e.e;if(!(t&64)){e.e=t|64;let n=e.o;n?Q(n.r):W[J++]=e}},pe=(e,t)=>{if(t&16||t&32&&Re(e.s,e)){let i=m(e);me(e),P();try{e.d()}finally{M(),m(i),ve(e)}return}t&32&&(e.e=t&-33);let n=e.s;for(;n;){let i=n.c,s=i.e;s&64&&pe(i,i.e=s&-65),n=n.n}},Ce=e=>{let t=e.e;if(t&16||t&32&&Re(e.s,e)){if(de(e)){let n=e.o;n&&V(n)}}else t&32&&(e.e=t&-33);return y&&B(e,y),e.t},we=(e,...t)=>{if(t.length){let i=t[0];if(e.t!==(e.t=i)){e.e=17;let s=e.o;return s&&($e(s),G||fe()),!0}return!1}let n=e.t;if(e.e&16&&ge(e,n)){let i=e.o;i&&V(i)}return y&&B(e,y),n},ye=e=>{let t=e.s;for(;t;)t=N(t,e);let n=e.o;n&&N(n),e.e=0},B=(e,t)=>{let n=t.a;if(n&&n.c===e)return;let i,s=t.e&4;if(s&&(i=n?n.n:t.s,i&&i.c===e)){t.a=i;return}let a=e.g;if(a&&a.r===t&&(!s||he(a,t)))return;let o=t.a=e.g={c:e,r:t,l:n,n:i,u:a};i&&(i.l=o),n?n.n=o:t.s=o,a?a.i=o:e.o=o},N=(e,t=e.r)=>{let n=e.c,i=e.l,s=e.n,a=e.i,o=e.u;if(s?s.l=i:t.a=i,i?i.n=s:t.s=s,a?a.u=o:n.g=o,o)o.i=a;else if(!(n.o=a))if("getter"in n){let r=n.s;if(r){n.e=17;do r=N(r,n);while(r)}}else"previousValue"in n||ye(n);return s},$e=e=>{let t=e.i,n;e:for(;;){let i=e.r,s=i.e;if(s&3&&(s&60?s&12?s&4?!(s&48)&&he(e,i)?(i.e=s|40,s&=1):s=0:i.e=s&-9|32:s=0:i.e=s|32,s&2&&Q(i),s&1)){let a=i.o;if(a){e=a,a.i&&(n={t,f:n},t=e.i);continue}}if(e=t){t=e.i;continue}for(;n;)if(e=n.t,n=n.f,e){t=e.i;continue e}break}},me=e=>{e.a=void 0,e.e=e.e&-57|4},ve=e=>{let t=e.a,n=t?t.n:e.s;for(;n;)n=N(n,e);e.e&=-5},Re=(e,t)=>{let n,i=0;e:for(;;){let s=e.c,a=s.e,o=!1;if(t.e&16)o=!0;else if((a&17)===17){if(se(s)){let r=s.o;r.i&&V(r),o=!0}}else if((a&33)===33){(e.i||e.u)&&(n={t:e,f:n}),e=s.s,t=s,++i;continue}if(!o&&e.n){e=e.n;continue}for(;i;){--i;let r=t.o,d=r.i;if(d?(e=n.t,n=n.f):e=r,o){if(se(t)){d&&V(r),t=e.r;continue}}else t.e&=-33;if(t=e.r,e.n){e=e.n;continue e}o=!1}return o}},V=e=>{do{let t=e.r,n=e.i,i=t.e;(i&48)===32&&(t.e=i|16,i&2&&Q(t)),e=n}while(e)},he=(e,t)=>{let n=t.a;if(n){let i=t.s;do{if(i===e)return!0;if(i===n)break;i=i.n}while(i)}return!1},U=e=>{let t=v,n=e.split(".");for(let i of n){if(t==null||!Object.hasOwn(t,i))return;t=t[i]}return t},oe=Symbol("delete"),_=(e,t="")=>{let n=Array.isArray(e);if(n||b(e)){let i=n?[]:{};for(let a in e)i[a]=T(_(e[a],`${t+a}.`));let s=T(0);return new Proxy(i,{get:(a,o)=>{if(!(o==="toJSON"&&!Object.hasOwn(i,o)))return n&&o in Array.prototype?(s(),i[o]):typeof o=="symbol"?i[o]:((!Object.hasOwn(i,o)||i[o]()==null)&&(i[o]=T(""),g({[t+o]:""}),s(s()+1)),i[o]())},set:(a,o,r)=>(r===oe?Object.hasOwn(i,o)&&(delete i[o],g({[t+o]:oe}),s(s()+1)):n&&o==="length"?(i[o]=r,g({[t.slice(0,-1)]:i}),s(s()+1)):Object.hasOwn(i,o)?r==null?i[o](null)&&g({[t+o]:null}):Object.hasOwn(r,z)?(i[o]=r,g({[t+o]:""})):i[o](_(r,`${t+o}.`))&&g({[t+o]:r}):r!=null&&(Object.hasOwn(r,z)?(i[o]=r,g({[t+o]:""})):(i[o]=T(_(r,`${t+o}.`)),g({[t+o]:r})),s(s()+1)),!0),deleteProperty:(a,o)=>(Object.hasOwn(i,o)&&i[o](null)&&g({[t+o]:null}),!0),ownKeys:()=>(s(),Reflect.ownKeys(i)),has(a,o){return s(),o in i}})}return e},g=e=>{if(e&&H(D,e),!G&&!Y(D)){let t=D;D={},document.dispatchEvent(new CustomEvent(ie,{detail:t}))}},xe=(e,{ifMissing:t}={})=>{P();for(let n in e)e[n]==null?t||delete v[n]:Ee(e[n],n,v,"",t);M()},Ee=(e,t,n,i,s)=>{if(b(e)){Object.hasOwn(n,t)&&(b(n[t])||Array.isArray(n[t]))||(n[t]={});for(let a in e)e[a]==null?s||delete n[t][a]:Ee(e[a],a,n[t],`${i+t}.`,s)}else s&&Object.hasOwn(n,t)||(n[t]=e)};function Te({include:e=/.*/,exclude:t=/(?!)/}={},n=v){let i={},s=[[n,""]];for(;s.length;){let[a,o]=s.pop();for(let r in a)b(a[r])?s.push([a[r],`${o+r}.`]):re(e).test(o+r)&&!re(t).test(o+r)&&(i[o+r]=U(o+r))}return H({},i)}function re(e){return typeof e=="string"?RegExp(e.replace(/^\/|\/$/g,"")):e}var v=_({}),O={},k=[],Se=[],F=new Map,K=null,S="";function be(e){S=e}function Ae(e){return S?`data-${S}-${e}`:`data-${e}`}function Oe(...e){for(let t of e){let n={plugin:t,actions:O,root:v,filtered:Te,signal:T,computed:ce,effect:le,mergePatch:xe,peek:ue,getPath:U,startBatch:P,endBatch:M,initErr:0};if(n.initErr=q.bind(0,n),t.type==="action")O[t.name]=t;else if(t.type==="attribute")k.push(t),t.onGlobalInit?.(n);else if(t.type==="watcher")t.onGlobalInit?.(n);else throw n.initErr("InvalidPluginType")}k.sort((t,n)=>{let i=n.name.length-t.name.length;return i!==0?i:t.name.localeCompare(n.name)}),Se=k.map(t=>RegExp(`^${t.name}([A-Z]|_|$)`))}function j(e){let t=`[${Ae("ignore")}]`;for(let n of e)if(!n.closest(t))for(let i in n.dataset)Fe(n,i,n.dataset[i])}function ae(e){for(let t of e){let n=F.get(t);if(F.delete(t)){for(let i of n.values())i();n.clear()}}}function Z(e=document.body){queueMicrotask(()=>{j([e]),j(e.querySelectorAll("*")),K||(K=new MutationObserver(De),K.observe(e,{subtree:!0,childList:!0,attributes:!0}))})}function Fe(e,t,n){if(t.startsWith(S)){let i=A(S?t.slice(S.length):t),s=k.find((a,o)=>Se[o].test(i));if(s){let[a,...o]=i.slice(s.name.length).split(/__+/),r=!!a;r&&(a=A(a));let d=!!n,l={plugin:s,actions:O,root:v,filtered:Te,signal:T,computed:ce,effect:le,mergePatch:xe,peek:ue,getPath:U,startBatch:P,endBatch:M,initErr:0,el:e,rawKey:i,key:a,value:n,mods:new Map,runtimeErr:0,rx:0};l.initErr=q.bind(0,l),l.runtimeErr=ne.bind(0,l),(s.shouldEvaluate===void 0||s.shouldEvaluate===!0)&&(l.rx=Le(l));let R=s.keyReq||"allowed";if(r){if(R==="denied")throw l.runtimeErr(`${s.name}KeyNotAllowed`)}else if(R==="must")throw l.runtimeErr(`${s.name}KeyRequired`);let h=s.valReq||"allowed";if(d){if(h==="denied")throw l.runtimeErr(`${s.name}ValueNotAllowed`)}else if(h==="must")throw l.runtimeErr(`${s.name}ValueRequired`);if(R==="exclusive"||h==="exclusive"){if(r&&d)throw l.runtimeErr(`${s.name}KeyAndValueProvided`);if(!r&&!d)throw l.runtimeErr(`${s.name}KeyOrValueRequired`)}for(let c of o){let[f,...p]=c.split(".");l.mods.set(A(f),new Set(p.map(x=>x.toLowerCase())))}let u=s.onLoad(l);if(u){let c=F.get(e);c?c.get(i)?.():(c=new Map,F.set(e,c)),c.set(i,u)}}}}function De(e){let t=`[${Ae("ignore")}]`;for(let{target:n,type:i,attributeName:s,addedNodes:a,removedNodes:o}of e)if(i==="childList"){for(let r of o)w(r)&&(ae([r]),ae(r.querySelectorAll("*")));for(let r of a)w(r)&&(j([r]),j(r.querySelectorAll("*")))}else if(i==="attributes"&&w(n)&&!n.closest(t)){let r=A(s.slice(5)),d=n.getAttribute(s);if(d===null){let l=F.get(n);l&&(l.get(r)?.(),l.delete(r))}else Fe(n,r,d)}}function Le(e){let t="",n=e.plugin||void 0;if(n?.returnsValue){let u=/(\/(\\\/|[^/])*\/|"(\\"|[^"])*"|'(\\'|[^'])*'|`(\\`|[^`])*`|\(\s*((function)\s*\(\s*\)|(\(\s*\))\s*=>)\s*(?:\{[\s\S]*?\}|[^;){]*)\s*\)\s*\(\s*\)|[^;])+/gm,c=e.value.trim().match(u);if(c){let f=c.length-1,p=c[f].trim();p.startsWith("return")||(c[f]=`return (${p});`),t=c.join(`;
`)}}else t=e.value.trim();t=t.replace(/\$\['([a-zA-Z_$\d][\w$]*)'\]/g,"$$$1").replace(/\$([a-zA-Z_\d]\w*(?:[.-]\w+)*)/g,(u,c)=>c.split(".").reduce((p,x)=>`${p}['${x}']`,"$")).replace(/\[(\$[a-zA-Z_\d]\w*)\]/g,(u,c)=>`[$['${c.slice(1)}']]`);let i=new Map,s=RegExp(`(?:${C})(.*?)(?:${I})`,"gm"),a=0;for(let u of t.matchAll(s)){let c=u[1],f=`dsEscaped${a++}`;i.set(f,c),t=t.replace(C+c+I,f)}let o=(u,c)=>`${u}${$(c).replaceAll(/\./g,"_")}`,r=new Set,d=RegExp(`@(${Object.keys(O).join("|")})\\(`,"gm"),l=[...t.matchAll(d)],R=new Set,h=new Set;if(l.length){let u=`${E}Act_`;for(let c of l){let f=c[1],p=O[f];if(!p)continue;r.add(f);let x=o(u,f);t=t.replace(`@${f}(`,`${x}(`),R.add(x),h.add((...Pe)=>p.fn(e,...Pe))}}for(let[u,c]of i)t=t.replace(u,c);e.fnContent=t;try{let u=Function("el","$",...n?.argNames||[],...R,t);return(...c)=>{try{return u(e.el,v,...c,...h)}catch(f){throw e.runtimeErr("ExecuteExpression",{error:f.message})}}}catch(u){throw e.runtimeErr("GenerateExpression",{error:u.message})}}Z();export{Z as apply,Oe as load,be as setAlias};
//# sourceMappingURL=datastar-core.js.map
