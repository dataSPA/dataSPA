// Datastar Core v1.0.0-RC.2
var X=/ðŸ–•JS_DSðŸš€/.source,C=X.slice(0,5),I=X.slice(4),T="datastar";function w(e){return e instanceof HTMLElement||e instanceof SVGElement}var S=e=>e!==null&&typeof e=="object"&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null);function Y(e){for(let t in e)if(Object.hasOwn(e,t))return!1;return!0}var K=(e,t)=>{for(let n in t){let i=n.split("."),s=i.pop(),r=i.reduce((o,a)=>o[a]??={},e);r[s]=t[n]}return e};var ee=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/([a-z])([0-9]+)/gi,"$1-$2").replace(/([0-9]+)([a-z])/gi,"$1-$2").toLowerCase(),A=e=>ee(e).replace(/-./g,t=>t[1].toUpperCase()),$=e=>ee(e).replace(/-/g,"_");var Pe="https://data-star.dev/errors";function te(e,t,n={}){let i=new Error;i.name=`${T} ${e} error`;let s=$(t),r=new URLSearchParams({metadata:JSON.stringify(n)}).toString(),o=JSON.stringify(n,null,2);return i.message=`${t}
More info: ${Pe}/${e}/${s}?${r}
Context: ${o}`,i}function ne(e,t,n={}){let i={plugin:{name:t.plugin.name,type:t.plugin.type}};return te("init",e,Object.assign(i,n))}function ie(e,t,n={}){let i={plugin:{name:e.plugin.name,type:e.plugin.type},element:{id:e.el.id,tag:e.el.tagName},expression:{rawKey:e.rawKey,key:e.key,value:e.value,fnContent:e.fnContent}};return te("runtime",t,Object.assign(i,n))}var se=`${T}-signal-patch`;var D={},H=[],j=0,L=0,J=0,y,P=()=>{j++},M=()=>{--j||(le(),g())},E=e=>Ce.bind(0,{previousValue:e,t:e,e:1}),W=Symbol("computed"),re=e=>{let t=Me.bind(0,{e:17,getter:e});return t[W]=1,t},ce=e=>{let t={d:e,e:2};y&&B(t,y);let n=m(t);P();try{t.d()}finally{M(),m(n)}return ge.bind(0,t)},z=e=>{let t=m(void 0);try{return e()}finally{m(t)}},le=()=>{for(;L<J;){let e=H[L];H[L++]=void 0,de(e,e.e&=-65)}L=0,J=0},oe=e=>"getter"in e?ue(e):fe(e,e.t),m=e=>{let t=y;return y=e,t},ue=e=>{let t=m(e);pe(e);try{let n=e.t;return n!==(e.t=e.getter(n))}finally{m(t),ye(e)}},fe=(e,t)=>(e.e=1,e.previousValue!==(e.previousValue=t)),Q=e=>{let t=e.e;if(!(t&64)){e.e=t|64;let n=e.o;n?Q(n.a):H[J++]=e}},de=(e,t)=>{if(t&16||t&32&&me(e.s,e)){let i=m(e);pe(e),P();try{e.d()}finally{M(),m(i),ye(e)}return}t&32&&(e.e=t&-33);let n=e.s;for(;n;){let i=n.c,s=i.e;s&64&&de(i,i.e=s&-65),n=n.n}},Me=e=>{let t=e.e;if(t&16||t&32&&me(e.s,e)){if(ue(e)){let n=e.o;n&&V(n)}}else t&32&&(e.e=t&-33);return y&&B(e,y),e.t},Ce=(e,...t)=>{if(t.length){let i=t[0];if(e.t!==(e.t=i)){e.e=17;let s=e.o;return s&&(we(s),j||le()),!0}return!1}let n=e.t;if(e.e&16&&fe(e,n)){let i=e.o;i&&V(i)}return y&&B(e,y),n},ge=e=>{let t=e.s;for(;t;)t=k(t,e);let n=e.o;n&&k(n),e.e=0},B=(e,t)=>{let n=t.r;if(n&&n.c===e)return;let i,s=t.e&4;if(s&&(i=n?n.n:t.s,i&&i.c===e)){t.r=i;return}let r=e.g;if(r&&r.a===t&&(!s||ve(r,t)))return;let o=t.r=e.g={c:e,a:t,l:n,n:i,u:r};i&&(i.l=o),n?n.n=o:t.s=o,r?r.i=o:e.o=o},k=(e,t=e.a)=>{let n=e.c,i=e.l,s=e.n,r=e.i,o=e.u;if(s?s.l=i:t.r=i,i?i.n=s:t.s=s,r?r.u=o:n.g=o,o)o.i=r;else if(!(n.o=r))if("getter"in n){let a=n.s;if(a){n.e=17;do a=k(a,n);while(a)}}else"previousValue"in n||ge(n);return s},we=e=>{let t=e.i,n;e:for(;;){let i=e.a,s=i.e;if(s&3&&(s&60?s&12?s&4?!(s&48)&&ve(e,i)?(i.e=s|40,s&=1):s=0:i.e=s&-9|32:s=0:i.e=s|32,s&2&&Q(i),s&1)){let r=i.o;if(r){e=r,r.i&&(n={t,f:n},t=e.i);continue}}if(e=t){t=e.i;continue}for(;n;)if(e=n.t,n=n.f,e){t=e.i;continue e}break}},pe=e=>{e.r=void 0,e.e=e.e&-57|4},ye=e=>{let t=e.r,n=t?t.n:e.s;for(;n;)n=k(n,e);e.e&=-5},me=(e,t)=>{let n,i=0;e:for(;;){let s=e.c,r=s.e,o=!1;if(t.e&16)o=!0;else if((r&17)===17){if(oe(s)){let a=s.o;a.i&&V(a),o=!0}}else if((r&33)===33){(e.i||e.u)&&(n={t:e,f:n}),e=s.s,t=s,++i;continue}if(!o&&e.n){e=e.n;continue}for(;i;){--i;let a=t.o,d=a.i;if(d?(e=n.t,n=n.f):e=a,o){if(oe(t)){d&&V(a),t=e.a;continue}}else t.e&=-33;if(t=e.a,e.n){e=e.n;continue e}o=!1}return o}},V=e=>{do{let t=e.a,n=e.i,i=t.e;(i&48)===32&&(t.e=i|16,i&2&&Q(t)),e=n}while(e)},ve=(e,t)=>{let n=t.r;if(n){let i=t.s;do{if(i===e)return!0;if(i===n)break;i=i.n}while(i)}return!1},U=e=>e.split(".").reduce((t,n)=>t[n],v),Re=e=>z(()=>e.split(".").reduce((t,n)=>t&&Object.hasOwn(t,n)?t[n]:void 0,v)!==void 0),ae=Symbol("delete"),_=(e,t="")=>{let n=Array.isArray(e);if(n||S(e)){let i=n?[]:{};for(let r in e)i[r]=E(_(e[r],`${t+r}.`));let s=E(0);return new Proxy(i,{get:(r,o)=>{if(!(o==="toJSON"&&!Object.hasOwn(i,o)))return n&&o in Array.prototype?(s(),i[o]):((!Object.hasOwn(i,o)||i[o]()==null)&&(i[o]=E(""),g({[t+o]:""}),s(s()+1)),i[o]())},set:(r,o,a)=>(a===ae?Object.hasOwn(i,o)&&(delete i[o],g({[t+o]:ae}),s(s()+1)):n&&o==="length"?(i[o]=a,g({[t.slice(0,-1)]:i}),s(s()+1)):Object.hasOwn(i,o)?a==null?i[o](null)&&g({[t+o]:null}):Object.hasOwn(a,W)?(i[o]=a,g({[t+o]:""})):i[o](_(a,`${t+o}.`))&&g({[t+o]:a}):a!=null&&(Object.hasOwn(a,W)?(i[o]=a,g({[t+o]:""})):(i[o]=E(_(a,`${t+o}.`)),g({[t+o]:a})),s(s()+1)),!0),deleteProperty:(r,o)=>(Object.hasOwn(i,o)&&i[o](null)&&g({[t+o]:null}),!0),ownKeys:()=>(s(),Reflect.ownKeys(i)),has(r,o){return s(),o in i}})}return e},g=e=>{if(e&&K(D,e),!j&&!Y(D)){let t=D;D={},document.dispatchEvent(new CustomEvent(se,{detail:t}))}},he=(e,{ifMissing:t}={})=>{P();for(let n in e)e[n]==null?t||delete v[n]:xe(e[n],n,v,"",t);M()},xe=(e,t,n,i,s)=>{if(S(e)){Object.hasOwn(n,t)&&(S(n[t])||Array.isArray(n[t]))||(n[t]={});for(let r in e)e[r]==null?s||delete n[t][r]:xe(e[r],r,n[t],`${i+t}.`,s)}else s&&Object.hasOwn(n,t)||(n[t]=e)};function Te({include:e=/.*/,exclude:t=/(?!)/}={},n=v){let i={},s=[[n,""]];for(;s.length;){let[r,o]=s.pop();for(let a in r)S(r[a])?s.push([r[a],`${o+a}.`]):e.test(o+a)&&!t.test(o+a)&&(i[o+a]=U(o+a))}return K({},i)}var v=_({}),F={},N=[],Ee=[],b=new Map,q=null,O="";function Se(e){O=e}function Ae(e){return O?`data-${O}-${e}`:`data-${e}`}function be(...e){for(let t of e){let n={plugin:t,actions:F,root:v,filtered:Te,signal:E,computed:re,effect:ce,mergePatch:he,peek:z,getPath:U,hasPath:Re,startBatch:P,endBatch:M};if(t.type==="action")F[t.name]=t;else if(t.type==="attribute")N.push(t),t.onGlobalInit?.(n);else if(t.type==="watcher")t.onGlobalInit?.(n);else throw ne("InvalidPluginType",n)}N.sort((t,n)=>{let i=n.name.length-t.name.length;return i!==0?i:t.name.localeCompare(n.name)}),Ee=N.map(t=>RegExp(`^${t.name}([A-Z]|_|$)`))}function G(e){let t=`[${Ae("ignore")}]`;for(let n of e)if(!n.closest(t))for(let i in n.dataset)Fe(n,i,n.dataset[i])}function Z(e=document.body){queueMicrotask(()=>{G([e]),G(e.querySelectorAll("*")),q||(q=new MutationObserver($e),q.observe(e,{subtree:!0,childList:!0,attributes:!0}))})}function Fe(e,t,n){let i=A(O?t.slice(O.length):t),s=N.find((r,o)=>Ee[o].test(i));if(s){let[r,...o]=i.slice(s.name.length).split(/__+/),a=!!r;a&&(r=A(r));let d=!!n,l={plugin:s,actions:F,root:v,filtered:Te,signal:E,computed:re,effect:ce,mergePatch:he,peek:z,getPath:U,hasPath:Re,startBatch:P,endBatch:M,el:e,rawKey:i,key:r,value:n,mods:new Map,runtimeErr:0,rx:0};l.runtimeErr=ie.bind(0,l),(s.shouldEvaluate===void 0||s.shouldEvaluate===!0)&&(l.rx=De(l));let R=s.keyReq||"allowed";if(a){if(R==="denied")throw l.runtimeErr(`${s.name}KeyNotAllowed`)}else if(R==="must")throw l.runtimeErr(`${s.name}KeyRequired`);let h=s.valReq||"allowed";if(d){if(h==="denied")throw l.runtimeErr(`${s.name}ValueNotAllowed`)}else if(h==="must")throw l.runtimeErr(`${s.name}ValueRequired`);if(R==="exclusive"||h==="exclusive"){if(a&&d)throw l.runtimeErr(`${s.name}KeyAndValueProvided`);if(!a&&!d)throw l.runtimeErr(`${s.name}KeyOrValueRequired`)}for(let c of o){let[f,...p]=c.split(".");l.mods.set(A(f),new Set(p.map(x=>x.toLowerCase())))}let u=s.onLoad(l);if(u){let c=b.get(e);c?c.get(i)?.():(c=new Map,b.set(e,c)),c.set(i,u)}}}function $e(e){let t=`[${Ae("ignore")}]`;for(let{target:n,type:i,attributeName:s,addedNodes:r,removedNodes:o}of e)if(i==="childList"){for(let a of o)if(w(a)){let d=b.get(a);if(b.delete(a)){for(let l of d.values())l();d.clear()}}for(let a of r)w(a)&&(G([a]),G(a.querySelectorAll("*")))}else if(i==="attributes"&&w(n)&&!n.closest(t)){let a=A(s.slice(5)),d=n.getAttribute(s);if(d===null){let l=b.get(n);l&&(l.get(a)?.(),l.delete(a))}else Fe(n,a,d)}}function De(e){let t="",n=e.plugin||void 0;if(n?.returnsValue){let u=/(\/(\\\/|[^/])*\/|"(\\"|[^"])*"|'(\\'|[^'])*'|`(\\`|[^`])*`|\(\s*((function)\s*\(\s*\)|(\(\s*\))\s*=>)\s*(?:\{[\s\S]*?\}|[^;){]*)\s*\)\s*\(\s*\)|[^;])+/gm,c=e.value.trim().match(u);if(c){let f=c.length-1,p=c[f].trim();p.startsWith("return")||(c[f]=`return (${p});`),t=c.join(`;
`)}}else t=e.value.trim();t=t.replace(/\$\['([a-zA-Z_$][\w$]*)'\]/g,"$$$1").replace(/\$([a-zA-Z_]\w*(?:[.-]\w+)*)/g,(u,c)=>c.split(".").reduce((p,x)=>`${p}['${x}']`,"$")).replace(/\[(\$[a-zA-Z_]\w*)\]/g,(u,c)=>`[$['${c.slice(1)}']]`);let i=new Map,s=RegExp(`(?:${C})(.*?)(?:${I})`,"gm"),r=0;for(let u of t.matchAll(s)){let c=u[1],f=`dsEscaped${r++}`;i.set(f,c),t=t.replace(C+c+I,f)}let o=(u,c)=>`${u}${$(c).replaceAll(/\./g,"_")}`,a=new Set,d=RegExp(`@(${Object.keys(F).join("|")})\\(`,"gm"),l=[...t.matchAll(d)],R=new Set,h=new Set;if(l.length){let u=`${T}Act_`;for(let c of l){let f=c[1],p=F[f];if(!p)continue;a.add(f);let x=o(u,f);t=t.replace(`@${f}(`,`${x}(`),R.add(x),h.add((...Oe)=>p.fn(e,...Oe))}}for(let[u,c]of i)t=t.replace(u,c);e.fnContent=t;try{let u=Function("el","$",...n?.argNames||[],...R,t);return(...c)=>{try{return u(e.el,v,...c,...h)}catch(f){throw e.runtimeErr("ExecuteExpression",{error:f.message})}}}catch(u){throw e.runtimeErr("GenerateExpression",{error:u.message})}}Z();export{Z as apply,be as load,Se as setAlias};
//# sourceMappingURL=datastar-core.js.map
