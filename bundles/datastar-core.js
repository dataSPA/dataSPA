var ee=/ðŸ–•JS_DSðŸš€/.source,R=ee.slice(0,5),z=ee.slice(4),E="datastar";function M(e){return e instanceof HTMLElement||e instanceof SVGElement}var v=e=>e!==null&&typeof e=="object"&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null);var j=e=>{let t={};for(let[n,s]of e){let o=n.split("."),c=o.pop(),r=o.reduce((i,l)=>i[l]??={},t);r[c]=s}return t};var te=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/([a-z])([0-9]+)/gi,"$1-$2").replace(/([0-9]+)([a-z])/gi,"$1-$2").toLowerCase(),w=e=>te(e).replace(/-./g,t=>t[1].toUpperCase()),C=e=>te(e).replace(/-/g,"_");var Re="https://data-star.dev/errors";function ne(e,t,n={}){let s=new Error;s.name=`${E} ${e} error`;let o=C(t),c=new URLSearchParams({metadata:JSON.stringify(n)}).toString(),r=JSON.stringify(n,null,2);return s.message=`${t}
More info: ${Re}/${e}/${o}?${c}
Context: ${r}`,s}function V(e,t,n={}){let s={plugin:{name:e.plugin.name,type:e.plugin.type}};return ne("init",t,Object.assign(s,n))}function se(e,t,n={}){let s={plugin:{name:e.plugin.name,type:e.plugin.type},element:{id:e.el.id,tag:e.el.tagName},expression:{rawKey:e.rawKey,key:e.key,value:e.value,fnContent:e.fnContent}};return ne("runtime",t,Object.assign(s,n))}var oe=`${E}-signal-patch`;var re;(function(e){e[e.None=0]="None",e[e.Mutable=1]="Mutable",e[e.Watching=2]="Watching",e[e.RecursedCheck=4]="RecursedCheck",e[e.Recursed=8]="Recursed",e[e.Dirty=16]="Dirty",e[e.Pending=32]="Pending"})(re||(re={}));var y;(function(e){e[e.Queued=64]="Queued"})(y||(y={}));var N=[],J=[],Q=0,L=0,U=0,g,T=()=>{Q++},P=()=>{--Q||(de(),_())},$=e=>je.bind(0,{previousValue:e,value_:e,flags_:1}),Z=Symbol("computed"),ae=e=>{let t=Me.bind(0,{flags_:17,getter:e});return t[Z]=1,t},fe=e=>{let t={fn_:e,flags_:2};g&&W(t,g);let n=b(t);T();try{t.fn_()}finally{P(),b(n)}return ge.bind(0,t)},pe=e=>{let t=b(void 0);try{return e()}finally{b(t)}},de=()=>{for(;L<U;){let e=J[L];J[L++]=void 0,he(e,e.flags_&=~y.Queued)}L=0,U=0},ie=e=>"getter"in e?_e(e):me(e,e.value_),b=e=>{let t=g;return g=e,t},_e=e=>{let t=b(e);be(e);try{let n=e.value_;return n!==(e.value_=e.getter(n))}finally{b(t),ye(e)}},me=(e,t)=>(e.flags_=1,e.previousValue!==(e.previousValue=t)),B=e=>{let t=e.flags_;if(!(t&y.Queued)){e.flags_=t|y.Queued;let n=e.subs_;n?B(n.sub_):J[U++]=e}},he=(e,t)=>{if(t&16||t&32&&xe(e.deps_,e)){let s=b(e);be(e),T();try{e.fn_()}finally{P(),b(s),ye(e)}return}t&32&&(e.flags_=t&-33);let n=e.deps_;for(;n;){let s=n.dep_,o=s.flags_;o&y.Queued&&he(s,s.flags_=o&~y.Queued),n=n.nextDep_}},Me=e=>{let t=e.flags_;if(t&16||t&32&&xe(e.deps_,e)){if(_e(e)){let n=e.subs_;n&&G(n)}}else t&32&&(e.flags_=t&-33);return g&&W(e,g),e.value_},je=(e,...t)=>{if(t.length){let s=t[0];if(e.value_!==(e.value_=s)){e.flags_=17;let o=e.subs_;return o&&(Ce(o),Q||de()),!0}return!1}let n=e.value_;if(e.flags_&16&&me(e,n)){let s=e.subs_;s&&G(s)}return g&&W(e,g),n},ge=e=>{let t=e.deps_;for(;t;)t=I(t,e);let n=e.subs_;n&&I(n),e.flags_=0},W=(e,t)=>{let n=t.depsTail_;if(n&&n.dep_===e)return;let s,o=t.flags_&4;if(o&&(s=n?n.nextDep_:t.deps_,s&&s.dep_===e)){t.depsTail_=s;return}let c=e.subsTail_;if(c&&c.sub_===t&&(!o||Se(c,t)))return;let r=t.depsTail_=e.subsTail_={dep_:e,sub_:t,prevDep_:n,nextDep_:s,prevSub_:c};s&&(s.prevDep_=r),n?n.nextDep_=r:t.deps_=r,c?c.nextSub_=r:e.subs_=r},I=(e,t=e.sub_)=>{let n=e.dep_,s=e.prevDep_,o=e.nextDep_,c=e.nextSub_,r=e.prevSub_;if(o?o.prevDep_=s:t.depsTail_=s,s?s.nextDep_=o:t.deps_=o,c?c.prevSub_=r:n.subsTail_=r,r)r.nextSub_=c;else if(!(n.subs_=c))if("getter"in n){let i=n.deps_;if(i){n.flags_=17;do i=I(i,n);while(i)}}else"previousValue"in n||ge(n);return o},Ce=e=>{let t=e.nextSub_,n;e:for(;;){let s=e.sub_,o=s.flags_;if(o&3&&(o&60?o&12?o&4?!(o&48)&&Se(e,s)?(s.flags_=o|40,o&=1):o=0:s.flags_=o&-9|32:o=0:s.flags_=o|32,o&2&&B(s),o&1)){let c=s.subs_;if(c){e=c,c.nextSub_&&(n={value_:t,prev_:n},t=e.nextSub_);continue}}if(e=t){t=e.nextSub_;continue}for(;n;)if(e=n.value_,n=n.prev_,e){t=e.nextSub_;continue e}break}},be=e=>{e.depsTail_=void 0,e.flags_=e.flags_&-57|4},ye=e=>{let t=e.depsTail_,n=t?t.nextDep_:e.deps_;for(;n;)n=I(n,e);e.flags_&=-5},xe=(e,t)=>{let n,s=0;e:for(;;){let o=e.dep_,c=o.flags_,r=!1;if(t.flags_&16)r=!0;else if((c&17)===17){if(ie(o)){let i=o.subs_;i.nextSub_&&G(i),r=!0}}else if((c&33)===33){(e.nextSub_||e.prevSub_)&&(n={value_:e,prev_:n}),e=o.deps_,t=o,++s;continue}if(!r&&e.nextDep_){e=e.nextDep_;continue}for(;s;){--s;let i=t.subs_,l=i.nextSub_;if(l?(e=n.value_,n=n.prev_):e=i,r){if(ie(t)){l&&G(i),t=e.sub_;continue}}else t.flags_&=-33;if(t=e.sub_,e.nextDep_){e=e.nextDep_;continue e}r=!1}return r}},G=e=>{do{let t=e.sub_,n=e.nextSub_,s=t.flags_;(s&48)===32&&(t.flags_=s|16,s&2&&B(t)),e=n}while(e)},Se=(e,t)=>{let n=t.depsTail_;if(n){let s=t.deps_;do{if(s===e)return!0;if(s===n)break;s=s.nextDep_}while(s)}return!1},X=e=>{let t=x,n=e.split(".");for(let s of n){if(t==null||!Object.hasOwn(t,s))return;t=t[s]}return t},ce=Symbol("delete"),q=(e,t="")=>{let n=Array.isArray(e);if(n||v(e)){let s=n?[]:{};for(let c in e)s[c]=$(q(e[c],`${t+c}.`));let o=$(0);return new Proxy(s,{get(c,r){if(!(r==="toJSON"&&!Object.hasOwn(s,r)))return n&&r in Array.prototype?(o(),s[r]):typeof r=="symbol"?s[r]:((!Object.hasOwn(s,r)||s[r]()==null)&&(s[r]=$(""),_(t+r,""),o(o()+1)),s[r]())},set(c,r,i){let l=t+r;if(i===ce)Object.hasOwn(s,r)&&(delete s[r],_(l,ce),o(o()+1));else if(n&&r==="length"){let a=s[r]-i;if(s[r]=i,a>0){let m={};for(let d=i;d<s[r];d++)m[d]=null;_(t.slice(0,-1),m),o(o()+1)}}else Object.hasOwn(s,r)?i==null?s[r](null)&&_(l,null):Object.hasOwn(i,Z)?(s[r]=i,_(l,"")):s[r](q(i,`${l}.`))&&_(l,i):i!=null&&(Object.hasOwn(i,Z)?(s[r]=i,_(l,"")):(s[r]=$(q(i,`${l}.`)),_(l,i)),o(o()+1));return!0},deleteProperty(c,r){return Object.hasOwn(s,r)&&s[r](null)&&_(t+r,null),!0},ownKeys(){return o(),Reflect.ownKeys(s)},has(c,r){return o(),r in s}})}return e},_=(e,t)=>{if(e!==void 0&&t!==void 0&&N.push([e,t]),!Q&&N.length){let n=j(N);N.length=0,document.dispatchEvent(new CustomEvent(oe,{detail:n}))}},Y=(e,{ifMissing:t}={})=>{T();for(let n in e)e[n]==null?t||delete x[n]:$e(e[n],n,x,"",t);P()},Ee=(e,t={})=>Y(j(e),t),$e=(e,t,n,s,o)=>{if(v(e)){Object.hasOwn(n,t)&&(v(n[t])||Array.isArray(n[t]))||(n[t]={});for(let c in e)e[c]==null?o||delete n[t][c]:$e(e[c],c,n[t],`${s+t}.`,o)}else o&&Object.hasOwn(n,t)||(n[t]=e)};function Ae({include:e=/.*/,exclude:t=/(?!)/}={},n=x){let s=[],o=[[n,""]];for(;o.length;){let[c,r]=o.pop();for(let i in c){let l=r+i;v(c[i])?o.push([c[i],`${l}.`]):le(e).test(l)&&!le(t).test(l)&&s.push([l,X(l)])}}return j(s)}function le(e){return typeof e=="string"?RegExp(e.replace(/^\/|\/$/g,"")):e}var x=q({}),O={},k=[],ve=[],D=new Map,H=null,A="";function we(e){A=e}function Oe(e){return A?`data-${A}-${e}`:`data-${e}`}function De(...e){for(let t of e){let n={plugin:t,actions:O,root:x,filtered:Ae,signal:$,computed:ae,effect:fe,mergePatch:Y,mergePaths:Ee,peek:pe,getPath:X,startBatch:T,endBatch:P,initErr:0};if(n.initErr=V.bind(0,n),t.type==="action")O[t.name]=t;else if(t.type==="attribute")k.push(t),t.onGlobalInit?.(n);else if(t.type==="watcher")t.onGlobalInit?.(n);else throw n.initErr("InvalidPluginType")}k.sort((t,n)=>{let s=n.name.length-t.name.length;return s!==0?s:t.name.localeCompare(n.name)}),ve=k.map(t=>RegExp(`^${t.name}([A-Z]|_|$)`))}function K(e){let t=`[${Oe("ignore")}]`;for(let n of e)if(!n.closest(t))for(let s in n.dataset)Te(n,s,n.dataset[s])}function ue(e){for(let t of e){let n=D.get(t);if(D.delete(t)){for(let s of n.values())s();n.clear()}}}function F(e=document.body){queueMicrotask(()=>{K([e]),K(e.querySelectorAll("*")),H||(H=new MutationObserver(Ne),H.observe(e,{subtree:!0,childList:!0,attributes:!0}))})}function Te(e,t,n){if(t.startsWith(A)){let s=w(A?t.slice(A.length):t),o=k.find((c,r)=>ve[r].test(s));if(o){let[c,...r]=s.slice(o.name.length).split(/__+/),i=!!c;i&&(c=w(c));let l=!!n,a={plugin:o,actions:O,root:x,filtered:Ae,signal:$,computed:ae,effect:fe,mergePatch:Y,mergePaths:Ee,peek:pe,getPath:X,startBatch:T,endBatch:P,initErr:0,el:e,rawKey:s,key:c,value:n,mods:new Map,runtimeErr:0,rx:0};a.initErr=V.bind(0,a),a.runtimeErr=se.bind(0,a),(o.shouldEvaluate===void 0||o.shouldEvaluate===!0)&&(a.rx=Le(a));let m=o.keyReq||"allowed";if(i){if(m==="denied")throw a.runtimeErr(`${o.name}KeyNotAllowed`)}else if(m==="must")throw a.runtimeErr(`${o.name}KeyRequired`);let d=o.valReq||"allowed";if(l){if(d==="denied")throw a.runtimeErr(`${o.name}ValueNotAllowed`)}else if(d==="must")throw a.runtimeErr(`${o.name}ValueRequired`);if(m==="exclusive"||d==="exclusive"){if(i&&l)throw a.runtimeErr(`${o.name}KeyAndValueProvided`);if(!i&&!l)throw a.runtimeErr(`${o.name}KeyOrValueRequired`)}for(let u of r){let[p,...h]=u.split(".");a.mods.set(w(p),new Set(h.map(S=>S.toLowerCase())))}let f=o.onLoad(a);if(f){let u=D.get(e);u?u.get(s)?.():(u=new Map,D.set(e,u)),u.set(s,f)}}}}function Ne(e){let t=`[${Oe("ignore")}]`;for(let{target:n,type:s,attributeName:o,addedNodes:c,removedNodes:r}of e)if(s==="childList"){for(let i of r)M(i)&&(ue([i]),ue(i.querySelectorAll("*")));for(let i of c)M(i)&&(K([i]),K(i.querySelectorAll("*")))}else if(s==="attributes"&&M(n)&&!n.closest(t)){let i=w(o.slice(5)),l=n.getAttribute(o);if(l===null){let a=D.get(n);a&&(a.get(i)?.(),a.delete(i))}else Te(n,i,l)}}function Le(e){let t="",n=e.plugin||void 0;if(n?.returnsValue){let f=/(\/(\\\/|[^/])*\/|"(\\"|[^"])*"|'(\\'|[^'])*'|`(\\`|[^`])*`|\(\s*((function)\s*\(\s*\)|(\(\s*\))\s*=>)\s*(?:\{[\s\S]*?\}|[^;){]*)\s*\)\s*\(\s*\)|[^;])+/gm,u=e.value.trim().match(f);if(u){let p=u.length-1,h=u[p].trim();h.startsWith("return")||(u[p]=`return (${h});`),t=u.join(`;
`)}}else t=e.value.trim();t=t.replace(/\$\['([a-zA-Z_$\d][\w$]*)'\]/g,"$$$1").replace(/\$([a-zA-Z_\d]\w*(?:[.-]\w+)*)/g,(f,u)=>u.split(".").reduce((h,S)=>`${h}['${S}']`,"$")).replace(/\[(\$[a-zA-Z_\d]\w*)\]/g,(f,u)=>`[$['${u.slice(1)}']]`);let s=new Map,o=RegExp(`(?:${R})(.*?)(?:${z})`,"gm"),c=0;for(let f of t.matchAll(o)){let u=f[1],p=`dsEscaped${c++}`;s.set(p,u),t=t.replace(R+u+z,p)}let r=(f,u)=>`${f}${C(u).replaceAll(/\./g,"_")}`,i=new Set,l=RegExp(`@(${Object.keys(O).join("|")})\\(`,"gm"),a=[...t.matchAll(l)],m=new Set,d=new Set;if(a.length){let f=`${E}Act_`;for(let u of a){let p=u[1],h=O[p];if(!h)continue;i.add(p);let S=r(f,p);t=t.replace(`@${p}(`,`${S}(`),m.add(S),d.add((...Pe)=>h.fn(e,...Pe))}}for(let[f,u]of s)t=t.replace(f,u);e.fnContent=t;try{let f=Function("el","$",...n?.argNames||[],...m,t);return(...u)=>{try{return f(e.el,x,...u,...d)}catch(p){throw e.runtimeErr("ExecuteExpression",{error:p.message})}}}catch(f){throw e.runtimeErr("GenerateExpression",{error:f.message})}}F();export{F as apply,De as load,we as setAlias};
//# sourceMappingURL=datastar-core.js.map
